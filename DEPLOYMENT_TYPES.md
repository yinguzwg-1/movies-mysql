# 部署类型说明

## 问题背景

你遇到的问题是：云服务器上的 `nest_db` 数据库是空的，没有任何表，但增量部署没有执行任何SQL语句。

## 原因分析

### 增量部署的工作原理

增量部署脚本会：
1. 连接"源数据库"和"目标数据库"
2. 比较两个数据库的差异
3. 生成并执行差异SQL

**问题**：当源数据库和目标数据库都是同一个空数据库时，没有检测到任何差异，所以不会执行任何SQL。

### 完整部署的工作原理

完整部署会：
1. 直接执行 `database.sql` 文件
2. 创建所有表结构和初始数据
3. 不依赖数据库比较

## 解决方案

### 首次部署（推荐）

对于空数据库的首次部署，使用 **完整部署**：

1. 进入GitHub仓库 → Actions
2. 选择 "🚀 数据库部署" 工作流
3. 点击 "Run workflow"
4. 选择部署类型：**full**
5. 点击 "Run workflow"

### 后续更新

对于后续的数据库变更，使用 **增量部署**：

1. 推送代码到 `main` 分支（自动触发）
2. 或手动触发，选择部署类型：**incremental**

## 部署类型对比

| 类型 | 适用场景 | 工作原理 | 优点 | 缺点 |
|------|----------|----------|------|------|
| **完整部署** | 首次部署、空数据库 | 直接执行database.sql | 简单直接、确保完整 | 会覆盖现有数据 |
| **增量部署** | 后续更新、有数据 | 比较差异、只更新变更 | 安全、不覆盖数据 | 需要源数据库 |

## 使用建议

### 1. 首次部署
```bash
# 选择 full 部署类型
# 这会执行 database.sql 中的所有SQL语句
```

### 2. 日常更新
```bash
# 选择 incremental 部署类型
# 或者直接推送代码到main分支
```

### 3. 数据迁移
```bash
# 如果需要迁移数据，先备份现有数据
# 然后使用 full 部署类型
```

## 注意事项

1. **完整部署会覆盖数据**：如果数据库中有重要数据，请先备份
2. **增量部署需要源数据**：确保有参考数据库进行比较
3. **权限要求**：确保数据库用户有足够的权限执行SQL

## 故障排除

### 如果完整部署失败
1. 检查数据库连接配置
2. 确认数据库用户权限
3. 查看GitHub Actions日志

### 如果增量部署没有效果
1. 确认源数据库和目标数据库不同
2. 检查是否有实际的数据库变更
3. 考虑使用完整部署 